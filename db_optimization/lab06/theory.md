# Тригери

В роботі з базою даних іноді доводиться виконувати додаткові дії до або після запиту. Для цього існують тригери - функції, що можуть виконуватися в залежності від різних умов або запитів. В цій лабораторній роботі розглянемо їхнє створення та використання.

## Частина 1. Що таке тригер?

Тригер в PostgreSQL - це комбінація часу виклику, виду запиту, області дії та самої функції, що виконуватиметься. В цій СУБД неможливо використовувати тригер без функції. Тригери можуть ставитися на створення, оновлення або видалення рядків.

Розберемо створення тригера для автоматичного оновлення колонки updated_at. 

## Частина 2. Функція тригера

Функція тригера приймає 2 значення: NEW та OLD. NEW існує на створенні (нові дані) та оновленні (нові дані), OLD - на оновленні (попередні дані) та видаленні (дані, що видаляються):

```mysql
CREATE OR REPLACE FUNCTION set_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at := CURRENT_TIMESTAMP;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

Функція може повертати NEW, OLD або NULL. NEW повертає нові дані, OLD - старі дані або підтверджує видалення, NULL - відміняє дію. Окрім значень функція може викликати обробник помилок та логування.

## Частина 3. Створення тригера

Основні складові тригеру - це час виконання (`BEFORE`, `AFTER`, `INSTEAD OF` (тільки для `VIEW`)), області дії (`FOR EACH ROW` або `FOR EACH STATEMENT`) та вид запиту (`UPDATE`, `INSERT`, `DELETE` або `TRUNCATE`).

```mysql
CREATE TRIGGER trg_set_updated_at
BEFORE UPDATE ON employees
FOR EACH ROW
EXECUTE FUNCTION set_updated_at();
```

Область дії визначає, чи застосовується тригер до кожного рядка в змінах чи загалом до запиту (незалежно від кількості змінених рядків).

## Частина 4. Видалення тригера

Напишемо `DROP TRIGGER` або `DROP FUNCTION`, якщо потрібно видалити або змінити тригер
